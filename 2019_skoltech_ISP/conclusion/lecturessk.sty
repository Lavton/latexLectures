% lecture style main file
\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{lecturessk}[2018/11/03 The style file for additional commands for lecture creating]
\RequirePackage{beamerskoltech}
\RequirePackage{tikz}

\RequirePackage{url}
\urlstyle{sf}

\RequirePackage{verbatim}
\RequirePackage{cmap}
\RequirePackage{color}
\RequirePackage{cprotect}
\RequirePackage{setspace}
% \RequirePackage{listings} 
% \lstloadlanguages{[LaTeX]TeX}

% \lstset{
% language=[LaTeX]TeX, 
% inputencoding=utf8,
% extendedchars=\true, 
% backgroundcolor=\color{skoltechgreen}, 
% commentstyle=\color{green}, 
% keywordstyle=\color{blue}, 
% keepspaces=\true, 
% basicstyle=\ttfamily, 
% otherkeywords={usepackage,documentclass,begin,section,textit,slshape,ttfamily,small,
% bfseries,upshape,mdseries,rmfamily,normalsize,textsl,texttt,textbf,textup,textmd,textrm,
% scriptsize,part,chapter,subsection,subsubsection,paragraph,subparagraph},
% escapeinside={\%*}{*)} } 


\RequirePackage{listings}
\lstset
{
    language=[LaTeX]TeX,
    breaklines=true,
    basicstyle=\tt\scriptsize,
    keywordstyle=\color{blue},
    identifierstyle=\color{magenta},
    numbers=right,
    % stepnumber=1,
}

%https://texfaq.org/FAQ-twooptarg
\RequirePackage{xargs}
\newcommandx{\cwpa}[3][3=c]{
    \begin{columns}[#3]
        \begin{column}{0.45\textwidth}
            #1
        \end{column}
        \pause
        \begin{column}{0.45\textwidth}
            #2
        \end{column}
    \end{columns}
}

\RequirePackage{graphicx}
\newcommand{\insImg}[1]{
    \begin{center}
        \includegraphics[width=\textwidth,height=0.6\textheight,keepaspectratio]{#1}%
    \end{center}
}

\newcommand{\twocolImg}[2]{
    \begin{columns}
        \begin{column}{0.45\textwidth}
            #1
        \end{column}
        \begin{column}{0.45\textwidth}
            % https://tex.stackexchange.com/questions/3166/how-can-the-dimensions-of-a-box-be-retrieved-with-latex
            \savebox{\Abox}{\includegraphics[width=\textwidth, keepaspectratio]{#2}}
            \newlength{\myhh}
            \settoheight{\myhh}{\usebox{\Abox}}
            \raisebox{-0.5\myhh+1ex}[0pt][0pt]{\includegraphics[width=\textwidth, keepaspectratio]{#2}}
        \end{column}
    \end{columns}
}

\newcommandx{\samePosPicture}[3][3={}]{
    \begin{columns}[t]
        \begin{column}{0.42\textwidth}
            \lstinputlisting[linerange={#2}#3]{#1.tex}
        \end{column}
        \begin{column}{0.4\textwidth}
        
            \includegraphics[width=0.95\linewidth]{#1.pdf}
            
        \end{column}
    \end{columns}
}

\newcommand{\logshow}[3]{
    \begin{columns}
    \begin{column}{0.45\textwidth}
         \lstinputlisting[linerange={#2}]{#1.tex}
    \end{column}
    
    \begin{column}{0.45\textwidth}
         \lstinputlisting[language={},linerange={#3}, keywordstyle=\color{black}, identifierstyle=\color{black},]{#1.logp}
    \end{column}
    \end{columns}
}

\RequirePackage{pdfpages}

\RequirePackage{tikzpagenodes}

\def\magicPage{%
\begin{tikzpicture}[remember picture,overlay,shift={(current page.north east)}]
\node[anchor=north east,xshift=-0cm,yshift=-0cm]{%
{\includegraphics[width=1cm]{images/magic}}%
};
\end{tikzpicture}%
}

\def\toFrameTop#1{\begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
\node[anchor=north ,xshift=-0cm,yshift=0.1cm]{\normalfont\tiny #1};
\end{tikzpicture}}

\def\tW{\begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
\node[anchor=north ,xshift=-0cm,yshift=0.1cm]{\normalfont\tiny \TeX -way};
\end{tikzpicture}}

\def\lW{\begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
\node[anchor=north ,xshift=-0cm,yshift=0.1cm]{\normalfont\tiny \LaTeX -way};
\end{tikzpicture}}

% this appear before magic slide 
\def\preMagicPage{\inClass{%
\begin{tikzpicture}[remember picture,overlay,shift={(current page.north east)}]
%\node[anchor=north east,xshift=-2cm,yshift=-2cm]{%
%{
\draw[fill, anchor=north east,xshift=-1cm,yshift=-0.7cm] circle [radius=0.06];
%}%
% };
\end{tikzpicture}}%
}


\let\oldSkFootnote\skfootnote
\def\skfootnote#1{\oldSkFootnote{\slshape #1}}

\RequirePackage{xcolor}
%%%%literature
% https://yandex.ru/search/?text=цвета%20html&lr=213&rnd=63188 
% knuth the TeXBook
%% .pdf#page=10

% http://www.ctex.org/documents/shredder/src/texbook.pdf
\definecolor{knuthcolor}{RGB}{215, 125, 49}
% \newcommand{\knuthc}[1]{{\normalfont\color{knuthcolor}knuth: #1}}
\newcommandx{\knuthc}[2][2=0]{%
{\normalfont\color{knuthcolor}%
\href{%
http://www.ctex.org/documents/shredder/src/texbook.pdf%
\ifnum #2=0 %
    %
\else%
    ?\#page=#2%
\fi%
}{kn:~#1}%
}%
}

%Lvovsky
\definecolor{lvocolor}{RGB}{0, 253, 250}
% \newcommand{\lvoc}[1]{{\normalfont\color{lvocolor}\href{https://www.mccme.ru/free-books/llang/newllang.pdf}{lvovsky: #1}}}
\newcommandx{\lvoc}[2][2=0]{%
{\normalfont\color{lvocolor}%
\href{%
https://www.mccme.ru/free-books/llang/newllang.pdf%
\ifnum #2=0 %
    %
\else%
    ?\#page=#2%
\fi%
}{lv:~#1}%
}%
}

%Lvovsky
\definecolor{lmancolor}{RGB}{32, 21, 94}
\newcommandx{\lmanc}[2][2=0]{%
{\normalfont\color{lmancolor}%
\href{%
http://mirrors.mi.ras.ru/CTAN/info/latex2e-help-texinfo/latex2e.pdf%
\ifnum #2=0 %
    %
\else%
    ?\#page=#2%
\fi%
}{man:~#1}%
}%
}

% TikZ manual 
\definecolor{tikZcolor}{RGB}{243, 98, 35}
\newcommandx{\tikzc}[2][2=0]{%
{\normalfont\color{tikZcolor}%
\href{%
http://mirrors.ctan.org/graphics/pgf/base/doc/pgfmanual.pdf%
\ifnum #2=0 %
    %
\else%
    ?\#page=#2%
\fi%
}{TikZ:~#1}%
}%
}

% lamport latex 

\definecolor{lamcolor}{RGB}{184, 143, 255}
\newcommand{\lamc}[1]{{\normalfont\color{lamcolor}lamport: #1}}

% https://en.wikibooks.org/wiki/LaTeX/
% https://www.overleaf.com/learn/latex/
% https://tex.stackexchange.com/
\RequirePackage{url}

\def\stRepl https://tex.stackexchange.com/questions#1 {#1}
\newcommand{\stExC}[1]{
{\normalfont \href{https://tex.stackexchange.com/questions\stRepl #1 }{\raisebox{-0.5ex}{\includegraphics[width=3ex,height=3ex,keepaspectratio]{images/se_icon}}\!\!\url{\stRepl #1 }}}}

\def\wikiRepl https://en.wikibooks.org/wiki/LaTeX#1 {#1}
\newcommand{\wikiC}[1]{
{\normalfont \href{https://en.wikibooks.org/wiki/LaTeX\wikiRepl #1 }{\raisebox{-0.5ex}{\includegraphics[width=3ex,height=3ex,keepaspectratio]{images/wikibooks}}\!\!\url{\wikiRepl #1 }}}}

\def\overRepl https://www.overleaf.com/learn/latex#1 {#1}
\newcommand{\overC}[1]{
{\normalfont \href{https://www.overleaf.com/learn/latex\overRepl #1 }{\raisebox{-0.5ex}{\includegraphics[width=3ex,height=3ex,keepaspectratio]{images/overleaflogo}}\!\!\url{\overRepl #1 }}}}

\def\tugRepl https://www.tug.org/utilities/plain/cseq.html#1 {#1}
\newcommand{\tugC}[1]{
{\normalfont \href{https://www.tug.org/utilities/plain/cseq.html\tugRepl #1 }{\raisebox{-0.5ex}{\includegraphics[width=3ex,height=3ex,keepaspectratio]{images/tuglogo}}\!\url{\tugRepl #1 }}}}


%%%%/literature

\setlength{\skfootnotelen}{12cm}

% = command's color 
\newcommand{\ccol}[1]{{\tt\csk \string#1}}
\def\ocol#1[#2]{{\tt\string#1[{\csk #2}]}}
\def\ncol#1#2{{\tt \string#1\{{\csk #2}\}}}
\def\Oncol#1[#2]#3{{\tt \string#1[{\csk#2}]\{#3\}}}

%%%%% inclass tasks commands

\newcommand{\inClass}[1]{#1}

\newcommand{\inclassFrame}[1]{{\inClass{
    \setbeamertemplate{background canvas}{
        % \tikz[baseline]\node[anchor=base,draw=red,rounded corners,inner xsep=1ex,inner ysep =0.75ex, bottom color=red!20, top color=red!10]{\parbox{\textwidth}{oo}};%
    {\color{red}\rule{10pt}{\dimexpr\paperheight-30pt\relax}}%
    }
    \setbeamercolor{frametitle}{fg=red}
#1}}
}

\newcommandx{\inclassFrag}[2][2=2]{{\inClass{%
\newcommand{\insidesOfInClassFrag}{%
\vspace*{-1ex}\vspace{1pt}%
\vbox to 0pt{ %
\vspace{0.51ex}
\tikz[baseline]\node[anchor=base,draw=red,rounded corners,inner xsep=1ex,inner ysep =0.75ex, bottom color=red!20, top color=red!10]{\parbox{\textwidth}{#1}};%
\vss%
}%
}%
% if 0 -- exists for whole period as a box. 
% if -1 -- it last appeared -- pause before, nothing after
% if 1 -- we starts with it, but pause after
\ifnum #2=0%
    \insidesOfInClassFrag{}%
\else%
    \ifnum #2=-1%
        \pause%
        \insidesOfInClassFrag{}%
    \else%
        \only<#2>{%
            \insidesOfInClassFrag{}%
        }%
        \ifnum #2=1%
           \pause% 
        \else%
            \pause\pause%
        \fi%
    \fi%
\fi}}%
}


\def\sepOneLabel#1#2#3#4#5\relax{
    \innerPicturesOverlay{#2}{#4}{#5}{#1}{#3}
}

\def\sepBreaker#1#2#3#4, #5\relax{
    \sepOneLabel{\the#1}{#2}{#3}#4\relax
    \ifx\relax#5\relax
    \else
        \advance#1 by 1
        \sepBreaker{#1}{#2}{#3}#5\relax
    \fi
}

\def\innerPicturesOverlay#1#2#3#4#5{
    \only<#4>{\begin{columns}[t]
        \begin{column}{0.42\textwidth}
            \lstinputlisting[linerange={#2}#5]{#1.tex}
        \end{column}
        \begin{column}{0.4\textwidth}
        
            \includegraphics[width=0.95\linewidth, height=0.6\textheight, keepaspectratio]{#1#4.pdf}
            
        \end{column}
    \end{columns}
    
    #3}
}

\newcommandx{\posesPicturesOverlay}[3][3={}]{
    \newcount\slideNum
    \slideNum=1
    \sepBreaker{\slideNum}{#1}{#3}#2, \relax
}


\newcommand{\incPause}{\inClass{\pause}}

%%% uncomment to stop in-class action
\renewcommand{\inClass}[1]{}


